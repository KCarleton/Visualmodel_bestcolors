# Visualmodel_bestcolors
This R code uses the Receptor Noise Limited visual model (Vorobyev and Osoria 1998) to determine color discriminability between a pair of colors illuminated by the spacelight and viewed by a visual system. It calculates just noticeable differences (JNDs) for all pairwise color combinations to determine the color pair that is best discriminated. The calculations require an illuminant which is reflected from the set of colors and then detected by a trichromatic visual system. Discriminability is based on the quantum catch and a set of noise values for the three photoreceptors viewing each of the reflecting colors.

Program inputs and outputs:
1. The color reflectances are modeled based on Gaussians to be either peaked (blues and greens) or stepped (yellows to reds, where reflectance starts low and increases to a maximum). The peaked colors have a peak wavelength, a baseline and a peak width. The stepped colors have a baseline, a Gaussian shaped half peak, and then reach maximal reflectance at the peak wavelength and then stay at that max. Here we model these Gaussians using parameters determined from actual Lake Malawi cichlid color reflectances (Dalton et al 2010). We use colors that vary from 375 nm to 625 nm and can be spaced every 1, 5 or more nm apart. The transition from peaked to stepped colors occurs at 560 nm, again matching known cichlid reflectances.
2. The illuminants are side welling irradiances that are measured in the field.
3. The visual system includes a lens that has variable transmission across the wavelength spectrum. Here we use a violet spectrum from a Lake Malawi cichlid (Melanochromis auratus, Hofmann et al 2010). The light is then detected by three visual pigments. The visual pigment absorption profiles are built from Govardovskii (et al 2000) templates and require peak spectral wavelengths and A1/A2 chromophore (in the form of %A1 where %A1 + %A2 = 100). We use all seven cone visual pigments and determeing their sensitivities based on opsin sequence in comparison to cichlids with known peak sensitivities. We vary the retinal chromophore (%A1) though it has little effect. Finally, we know that cichlids can coexpression multiple visual pigments in the same photoreceptor. We can calculate the weighted combinations of pure visual pigments based on opsin gene expression to get the final three S M and L light absorbing pigments. The program has three visual pigment combinations, pure pigments based on SWS2a, RH2Aa and LWS ("long"), and two coexpressed combinations based on opsin gene expression for fish that are shallow or deep.
4. The noise values are taken to be 0.1 for the long wavelength cone and the other cones are weighted by their relative abundance. Since cichlids have square retinal mosaics, this means that S:M:L ratios are 1:2:2. Therefore noise values are 0.14:0.1:0.1.
5. The program calculates a matrix of JND values for all pairwise color combinations for two different illuminants and outputs two files if save2file = "Y".
6. The program can also generate several different plots including plots of the reflective colors (R), the visual pigments (V), the visual pigments and illuminant light (VL), reflectance and light (RL) and plotting the colors in the SHort Medium Long visual space triangle (T). Finally, having determined the best color pair, you canplot those two color reflectances times the illuminant and compare it to the visual pigments * lens transmission (Best).

The code is composed of two parts:
1. AquaVis_Acalliptera: The functions used to calculate different elements such as the Gaussian colors, the visual pigments, quantum catch and JNDs
2. VisualModel_Acalliptera: The code that sets the parameters and calls the functions to do the calculations.
